<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Simula√ß√£o ATS - Grupo 5</title>
    <style>
        /* --- GERAL --- */
        :root { --accent-blue: #2196F3; --accent-alert: #ff3d00; --yellow: #FFEB3B; }
        html,body{height:100%;margin:0}
        body {
            background-color: #050505;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* =========================================
           1. ESTILOS DA CAPA (CHUVA E RAIOS CSS)
           ========================================= */
        #cover-screen {
            position: fixed;
            inset:0;
            background-color: #050505;
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Arial Black', sans-serif;
            color: #fff;
            cursor: pointer;
            transition: opacity 1.2s ease-out;
        }

        .rain-back, .rain-front {
            position:absolute; inset:0;
            pointer-events:none;
        }
        .rain-back {
            background: linear-gradient(to bottom, transparent 50%, rgba(255,255,255,0.08) 100%);
            background-size: 2px 30px;
            animation: rain-fall-css 0.4s linear infinite;
            opacity: 0.28; z-index:1;
        }
        .rain-front {
            background: linear-gradient(to bottom, transparent 70%, rgba(255,255,255,0.35) 100%);
            background-size: 3px 25px;
            animation: rain-fall-css 0.2s linear infinite;
            opacity: 0.6; z-index:2;
        }
        .bolt {
            position: absolute; top: -20%; left: 50%; transform: translateX(-50%);
            width: 100px; height: 100vh; background: #fff;
            clip-path: polygon(50% 0%, 30% 60%, 45% 60%, 25% 100%, 75% 40%, 60% 40%, 80% 0%);
            box-shadow: 0 0 80px #fff, 0 0 150px #78aaff; z-index: 3; opacity: 0;
            animation: lightning 6s infinite;
            pointer-events:none;
        }
        .flash {
            position:absolute; inset:0; background:#fff; z-index:4; opacity:0; pointer-events:none;
            animation: flash-screen 6s infinite;
        }
        .content-box {
            position: relative; z-index: 10; background: rgba(0, 0, 0, 0.72);
            padding: 36px 56px; border: 1px solid rgba(255,255,255,0.14);
            border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.9);
            backdrop-filter: blur(3px); text-align: center;
            animation: shake-text 6s infinite;
            min-width:300px;
        }
        .content-box h1 { margin: 0; font-size: 2.6rem; text-transform: uppercase; letter-spacing: 4px; text-shadow: 0 0 8px rgba(255,255,255,0.45); }
        .content-box h2 { margin: 6px 0 18px 0; font-size: 1rem; color: #ff5252; text-transform: uppercase; letter-spacing: 1.6px; font-weight: 600; }
        .members { list-style: none; padding: 0; margin: 0; font-family: 'Segoe UI', sans-serif; font-size: 0.98rem; font-weight: 600; color: #cfcfcf; line-height: 1.6; }
        .start-msg { margin-top: 16px; font-size: 0.82rem; color: #9a9a9a; font-family: monospace; animation: blink 2s infinite; }

        @keyframes rain-fall-css { 0% { background-position: 0 0 } 100% { background-position: 20px 100vh } }
        @keyframes lightning { 0%,92%{opacity:0}93%{opacity:1}94%{opacity:0}95%{opacity:0.8}96%{opacity:0}100%{opacity:0} }
        @keyframes flash-screen { 0%,92%{opacity:0}93%{opacity:0.8}94%{opacity:0}95%{opacity:0.4}96%{opacity:0}100%{opacity:0} }
        @keyframes shake-text { 0%,92%{transform:translate(0,0)}93%{transform:translate(-4px,4px)}94%{transform:translate(4px,-4px)}95%{transform:translate(-4px,-4px)}96%{transform:translate(0,0)} }

        /* =========================================
           2. ESTILOS DO JOGO E PR√ìLOGO
           ========================================= */
        .background-fixed { position: fixed; inset:0; background-size: cover; background-position: center; z-index:-5; transition: all .9s ease; }
        .bg-prologue { filter: brightness(.42) contrast(1.05); transition: background-image .45s ease; }
        .bg-game { background-image: url('img1.jpg'); filter: brightness(.3) contrast(1.18) blur(2px); }

        /* Disaster layer (JS generated) */
        #disaster-layer { position: fixed; inset:0; pointer-events:none; z-index:900; display:none; overflow:hidden; }

        .rain-js { position:absolute; background:linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0.6)); width:2px; border-radius:2px; pointer-events:none; }
        .fire-particle { position:absolute; border-radius:50%; pointer-events:none; filter:blur(4px); mix-blend-mode:screen; }

        @keyframes rain-fall { to { transform: translateY(120vh) } }
        @keyframes rise { 0% { transform: translateY(0) scale(1); opacity: 0.9 } 100% { transform: translateY(-80vh) scale(.2); opacity: 0 } }

        /* Pr√≥logo container */
        #prologue-container { width: 92%; max-width: 920px; background-color: rgba(20,20,25,0.96); border:1px solid #444; border-top:5px solid var(--accent-blue); border-radius:8px; padding:34px; box-shadow:0 0 50px rgba(0,0,0,0.9); display:none; flex-direction:column; align-items:center; text-align:center; z-index:1000; animation:fadeIn 0.9s; position:relative; }
        #prologue-title { color: var(--accent-blue); font-size:1.35em; text-transform:uppercase; letter-spacing:1.8px; margin-bottom:16px; border-bottom:1px solid #333; padding-bottom:8px; width:100%; }
        #prologue-text { font-size:1.15em; line-height:1.6; min-height:170px; white-space:pre-wrap; margin-bottom:24px; text-align:left; color:#fff; }

        /* Buttons */
        .nav-buttons { display:flex; gap:14px; width:100%; justify-content:space-between; align-items:center; }
        .btn-prologue { background:transparent; border:1px solid var(--accent-blue); color:var(--accent-blue); padding:10px 26px; font-size:1em; cursor:pointer; transition:all .22s; font-family:inherit; border-radius:6px; }
        .btn-prologue:hover { background:var(--accent-blue); color:#000; }
        .btn-danger { border-color: var(--accent-alert); color: var(--accent-alert); }
        .btn-danger:hover { background: var(--accent-alert); color: #000; }

        /* Intro alert */
        #intro-screen { position:fixed; inset:0; background:rgba(0,0,0,0.92); z-index:2000; display:none; flex-direction:column; align-items:center; justify-content:center; text-align:center; opacity:0; }
        #intro-content h1 { color: var(--accent-alert); font-size:3.2em; margin:0; text-transform:uppercase; text-shadow:0 0 14px rgba(255,61,0,0.6); animation:pulse 1.4s infinite; letter-spacing:4px; }
        #intro-content h2 { color:#fff; font-weight:600; margin-top:8px; font-size:1.15em; }
        #btn-start-simulation { background:transparent; border:3px solid var(--accent-alert); color:var(--accent-alert); padding:18px 44px; font-size:1.2em; font-family:inherit; font-weight:700; cursor:pointer; margin-top:30px; border-radius:8px; }
        #btn-start-simulation:hover { background: var(--accent-alert); color:#000; box-shadow:0 0 30px var(--accent-alert); }

        /* Game container */
        #game-container { width:80%; max-width:820px; background-color: rgba(20,20,20,0.95); border:1px solid #444; border-left:5px solid #d32f2f; border-radius:8px; padding:34px; box-shadow: 0 0 30px rgba(0,0,0,0.8); min-height:360px; display:none; flex-direction:column; opacity:0; z-index:500; }
        .header { border-bottom:1px solid #555; padding-bottom:10px; margin-bottom:18px; display:flex; justify-content:space-between; font-size:0.9em; color:#aaa; }
        .status-blink { color:#d32f2f; font-weight:700; animation:blink 1s infinite; }
        #story-text { font-size:1.15em; line-height:1.6; white-space:pre-wrap; min-height:90px; color:#fff; }
        #feedback-area { margin-bottom:14px; font-weight:700; padding:12px; border-radius:6px; display:none; font-size:1.03em; }
        .feedback-success { background-color: rgba(46,125,50,0.12); border:1px solid #2e7d32; color:#a5d6a7; }
        .feedback-error { background-color: rgba(198,40,40,0.12); border:1px solid #c62828; color:#ef9a9a; }

        .choices { display:flex; flex-direction:column; gap:10px; margin-top:20px; opacity:0; transition:opacity 0.45s; }
        .btn { background:transparent; border:1px dashed var(--yellow); color:var(--yellow); padding:12px; text-align:left; font-family:inherit; font-size:1.02em; cursor:pointer; transition:all .18s; border-radius:6px; }
        .btn:hover { background:var(--yellow); color:#000; border-style:solid; transform:translateX(6px); }

        .cursor { display:inline-block; width:10px; height:1em; background-color:#0f0; animation:blink 1s infinite; vertical-align:bottom; margin-left:6px; }

        @keyframes blink { 0%,100%{opacity:1}50%{opacity:0.3} }
        @keyframes pulse { 0%{transform:scale(1)}50%{transform:scale(1.04);opacity:0.9}100%{transform:scale(1)} }
        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        @keyframes borderPulse { 0%{box-shadow:0 0 0 0 rgba(255,61,0,.7)} 70%{box-shadow:0 0 0 15px rgba(255,61,0,0)} 100%{box-shadow:0 0 0 0 rgba(255,61,0,0)} }
    </style>
</head>
<body>

    <!-- TELA DE CAPA -->
    <div id="cover-screen" aria-label="Tela de capa - clique para iniciar">
        <div class="rain-back"></div>
        <div class="rain-front"></div>
        <div class="bolt" aria-hidden="true"></div>
        <div class="flash" aria-hidden="true"></div>

        <div class="content-box" role="button" tabindex="0">
            <h1>GRUPO 05</h1>
            <h2>Cen√°rio: Desastre Ambiental</h2>
            <ul class="members" aria-hidden="false">
                <li>Pedro Cineli</li>
                <li>Alvaro</li>
                <li>Lucas Franklin</li>
                <li>Lucas Barbosa</li>
                <li>Israel</li>
                <li>Renan</li>
            </ul>
            <div class="start-msg">[ CLIQUE PARA INICIAR ]</div>
        </div>
    </div>

    <!-- FUNDO PRINCIPAL -->
    <div id="main-bg" class="background-fixed bg-prologue" style="display:none;"></div>

    <!-- CAMADA DE EFEITOS (CHUVA/FOGO DIN√ÇMICO) -->
    <div id="disaster-layer" aria-hidden="true"></div>

    <!-- √ÅUDIOS -->
    <!-- Observa√ß√£o: mantenha os arquivos audio1.mp3 .. audio7.mp3, noticia.mp3, audio.mp3 no mesmo diret√≥rio ou ajuste paths -->
    <audio id="audio-prologue" preload="auto"></audio>
    <audio id="audio-news" src="noticia.mp3" preload="auto"></audio>
    <audio id="audio-game" src="audio.mp3" preload="auto"></audio>

    <!-- PR√ìLOGO -->
    <div id="prologue-container" role="region" aria-label="Pr√≥logo t√©cnico">
        <div id="prologue-title">INTRODU√á√ÉO T√âCNICA</div>
        <div id="prologue-text"></div>

        <div class="nav-buttons">
            <button class="btn-prologue" id="btn-prev-prologue" style="visibility:hidden">Anterior</button>

            <button class="btn-prologue" id="btn-play-pause" style="min-width:160px">‚ñ∂Ô∏è Play</button>

            <button class="btn-prologue" id="btn-next-prologue">Pr√≥ximo ‚ûú</button>
        </div>
    </div>

    <!-- TELA DE ALERTA / INTRO -->
    <div id="intro-screen" aria-hidden="true">
        <div id="intro-content">
            <h1>ATEN√á√ÉO</h1>
            <h2>SITUA√á√ÉO DE DESASTRE EM ANDAMENTO</h2>
            <h2>A√á√ÉO IMEDIATA NECESS√ÅRIA</h2>
            <button id="btn-start-simulation">INICIAR OPERA√á√ÉO</button>
        </div>
    </div>

    <!-- CONTAINER DO JOGO -->
    <div id="game-container" role="main" aria-label="Sala de situa√ß√£o">
        <div class="header">
            <span>SALA DE SITUA√á√ÉO: GRUPO 5</span>
            <span class="status-blink">‚óè AO VIVO - PETR√ìPOLIS</span>
        </div>

        <div id="feedback-area" role="status"></div>

        <div id="text-container">
            <span id="story-text"></span><span class="cursor" aria-hidden="true"></span>
        </div>

        <div id="choices-container" class="choices" aria-live="polite"></div>
    </div>

<script>
    // --- REFER√äNCIAS GERAIS ---
    const coverScreen = document.getElementById('cover-screen');
    const prologueContainer = document.getElementById('prologue-container');
    const introScreen = document.getElementById('intro-screen');
    const gameContainer = document.getElementById('game-container');
    const mainBg = document.getElementById('main-bg');
    const disasterLayer = document.getElementById('disaster-layer');

    // √Åudios
    const audioPrologue = document.getElementById('audio-prologue');
    const audioNews = document.getElementById('audio-news');
    const audioGame = document.getElementById('audio-game');

    // Bot√µes
    const btnPlayPause = document.getElementById('btn-play-pause');
    const btnNext = document.getElementById('btn-next-prologue');
    const btnPrev = document.getElementById('btn-prev-prologue');
    const btnStartSim = document.getElementById('btn-start-simulation');

    // Controle
    let currentPrologueIndex = 0;
    let disasterInterval = null;
    let currentStage = 'cover'; // 'cover' | 'prologue' | 'intro' | 'game'

    // ---- DADOS DO PR√ìLOGO ----
    const prologueData = [
        { title:"IN√çCIO", text:`"Quando um desastre acontece ‚Äî seja um deslizamento, um inc√™ndio, um acidente qu√≠mico ou uma enchente ‚Äî o caos domina os primeiros minutos. Mas existe uma l√≥gica m√©dica por tr√°s das decis√µes que salvam vidas. Hoje voc√™ vai entender como funciona a atua√ß√£o do m√©dico em cen√°rios de desastre, desde os primeiros passos at√© as situa√ß√µes mais complexas."`, img:"https://www.pragmatismopolitico.com.br/wp-content/uploads/2018/05/acidente-cuba-e1527030296940.jpg", audio:"audio1.mp3", effectType:'rain' },
        { title:"O PAPEL DO M√âDICO", text:`"Um desastre √© qualquer evento que ultrapassa a capacidade normal de resposta do sistema de sa√∫de. E, nesse contexto, o m√©dico assume pap√©is que v√£o muito al√©m do consult√≥rio. Ele precisa entender fisiologia, toxicologia, epidemiologia e, principalmente, como priorizar vidas quando n√£o h√° recursos para todos.\n\n√â aqui que entram conceitos como triagem, manejo inicial das vias a√©reas, controle de hemorragias e tomada de decis√£o r√°pida."`, img:"https://images.unsplash.com/photo-1584036561566-baf8f5f1b144?auto=format&fit=crop&w=1920&q=80", audio:"audio2.mp3" },
        { title:"TRIAGEM (M√âTODO START)", text:`"A triagem √© o cora√ß√£o da resposta m√©dica. √â nela que o m√©dico define quem precisa de interven√ß√£o imediata, quem pode esperar e quem, infelizmente, n√£o tem chance real de sobreviv√™ncia dado o cen√°rio.\n\nO m√©todo START baseia-se em:\n‚Ä¢ Respira√ß√£o ‚Äì Se a v√≠tima n√£o respira ap√≥s reposicionamento das vias a√©reas, √© classificada como preta. Se respira >30 incurs√µes por minuto, √© vermelha.)\n‚Ä¢ Perfus√£o ‚Äì Tempo de enchimento capilar >2 segundos sugere choque hipovol√™mico pela perda aguda de volume.)\n‚Ä¢ Estado mental ‚Äì Incapacidade de seguir comandos indica poss√≠vel hip√≥xia ou perfus√£o cerebral inadequada.)"`, img:"https://images.unsplash.com/photo-1516574187841-69301976e49e?auto=format&fit=crop&w=1920&q=80", audio:"audio3.mp3" },
        { title:"SITUA√á√ïES SIMPLES", text:`"Mesmo nos desastres, a maior parte das demandas m√©dicas s√£o simples: ferimentos leves, crises de ansiedade, desidrata√ß√£o, hipoglicemia.\n\nNesses casos, o m√©dico atua como estabilizador: faz hidrata√ß√£o oral, sutura lacera√ß√µes, prescreve analg√©sicos, controla picos hipertensivos induzidos por estresse e monitora pessoas vulner√°veis, como gestantes e crian√ßas."`, img:"https://www.saude.sp.gov.br/resources/hospital-leonor-mendes-de-barros/acesso-rapido/primeiros-socorros-em-caso-de-incendio.jpg", audio:"audio4.mp3" },
        { title:"ALTA COMPLEXIDADE", text:`"Em outros cen√°rios, o m√©dico enfrenta quadros cr√≠ticos. Em inc√™ndios, por exemplo, a prioridade √© tratar hipoxemia e intoxica√ß√£o por mon√≥xido de carbono ‚Äî que compete com o O‚ÇÇ pela hemoglobina, causando hip√≥xia tecidual.\nEm deslizamentos, o risco √© a s√≠ndrome do esmagamento, marcada por libera√ß√£o de pot√°ssio e mioglobina para o sangue, podendo causar arritmias fatais e les√£o renal aguda.).\n\nEm acidentes qu√≠micos, a conduta envolve descontamina√ß√£o, neutraliza√ß√£o e uso de ant√≠dotos espec√≠ficos, como atropina e pralidoxima nos organofosforados.\n\nDecis√µes baseadas em fisiologia e protocolos."`, img:"https://ogimg.infoglobo.com.br/in/23946251-8e9-d10/FT1086A/GettyImages-56441651.jpg", audio:"audio5.mp3", effectType:'fire' },
        { title:"LOG√çSTICA E LIDERAN√áA", text:`"O m√©dico coordena fluxos e conversa com bombeiros e defesa civil.\n\nNo abrigo, o trabalho continua: vigil√¢ncia epidemiol√≥gica, preven√ß√£o de surtos, vacina√ß√£o e controle da √°gua."`, img:"https://cdn.folhape.com.br/img/c/1200/900/dn_arquivo/2020/01/medico1.jpg", audio:"audio6.mp3" },
        { title:"A ESS√äNCIA", text:`"No fim, atuar em um desastre √© equilibrar ci√™ncia, humanidade e estrat√©gia.\n\nA medicina nesses cen√°rios n√£o √© apenas t√©cnica; exige tamb√©m coragem e organiza√ß√£o quando tudo ao redor parece destru√≠do."`, img:"https://blog.unyleyamed.com.br/wp-content/uploads/2023/09/shutterstock_661890763-scaled.webp", audio:"audio7.mp3" }
    ];

    // --- EFEITOS VISUAIS (CHUVA / FOGO DIN√ÇMICO) ---
    function startDisasterEffect(type){
        stopDisasterEffect();
        disasterLayer.style.display = 'block';
        if(type === 'rain'){
            disasterInterval = setInterval(()=> {
                for(let i=0;i<4;i++){
                    const drop = document.createElement('div');
                    drop.className = 'rain-js';
                    const left = Math.random()*100;
                    const h = Math.random()*30 + 20;
                    drop.style.left = left + 'vw';
                    drop.style.top = (-Math.random()*30 - 40) + 'vh';
                    drop.style.height = h + 'px';
                    drop.style.width = '2px';
                    drop.style.opacity = (Math.random()*0.7 + 0.2).toString();
                    drop.style.animation = `rain-fall ${Math.random()*0.5 + 0.6}s linear`;
                    disasterLayer.appendChild(drop);
                    setTimeout(()=> drop.remove(), 1200);
                }
            }, 60);
        } else if(type === 'fire'){
            disasterInterval = setInterval(()=> {
                for(let i=0;i<3;i++){
                    const ember = document.createElement('div');
                    ember.className = 'fire-particle';
                    const left = Math.random()*100;
                    const size = Math.random()*20 + 6;
                    ember.style.left = left + 'vw';
                    ember.style.bottom = (-Math.random()*40 - 20) + 'px';
                    ember.style.width = size + 'px';
                    ember.style.height = size + 'px';
                    const color = Math.random()>0.5 ? 'rgba(255,80,0,0.85)' : 'rgba(255,200,0,0.6)';
                    ember.style.background = `radial-gradient(circle, ${color} 0%, rgba(255,0,0,0) 70%)`;
                    ember.style.animation = `rise ${Math.random()*1.2 + 0.9}s ease-out forwards`;
                    disasterLayer.appendChild(ember);
                    setTimeout(()=> ember.remove(), 2600);
                }
            }, 90);
        }
    }
    function stopDisasterEffect(){
        clearInterval(disasterInterval);
        disasterLayer.innerHTML = '';
        disasterLayer.style.display = 'none';
    }

    // --- CONTROLE DE √ÅUDIO / UTILS (fadeIn) ---
    function fadeInAudio(audioElement, duration = 800){
        try {
            audioElement.volume = 0;
            const step = 50;
            const steps = Math.max(1, Math.floor(duration / step));
            let current = 0;
            const iv = setInterval(()=> {
                current++;
                audioElement.volume = Math.min(1, (current/steps));
                if(current >= steps){ clearInterval(iv); audioElement.volume = 1; }
            }, step);
        } catch(e){ console.warn("fadeInAudio:", e); }
    }

    // Gerencia narra√ß√£o do pr√≥logo: troca arquivo e controla play/pause
    function manageAudioState(audioFile, shouldPlay = true){
        if (!audioPrologue.paused) audioPrologue.pause();
        if (audioPrologue.getAttribute('src') !== audioFile) {
            audioPrologue.src = audioFile;
            audioPrologue.load();
        }
        if (shouldPlay) {
            audioPrologue.play().then(()=> {
                btnPlayPause.innerText = "‚è∏Ô∏è Pausar Narra√ß√£o";
            }).catch(e=>{
                console.log("Autoplay bloqueado (prologue):", e);
                btnPlayPause.innerText = "‚ñ∂Ô∏è Tocar Narra√ß√£o";
            });
        } else {
            btnPlayPause.innerText = "‚ñ∂Ô∏è Tocar Narra√ß√£o";
        }
    }

    // --- ATUALIZA PR√ìLOGO ---
    function updatePrologue(){
        const data = prologueData[currentPrologueIndex];
        document.getElementById('prologue-title').innerText = data.title;
        document.getElementById('prologue-text').innerText = data.text;
        mainBg.style.backgroundImage = `url('${data.img}')`;
        mainBg.className = "background-fixed bg-prologue";

        if (data.effectType) startDisasterEffect(data.effectType);
        else stopDisasterEffect();

        btnPrev.style.visibility = currentPrologueIndex === 0 ? 'hidden' : 'visible';

        if (currentPrologueIndex === prologueData.length - 1) {
            btnNext.innerText = "IR PARA A√á√ÉO ‚ö†";
            btnNext.classList.add('btn-danger');
        } else {
            btnNext.innerText = "Pr√≥ximo ‚ûú";
            btnNext.classList.remove('btn-danger');
        }

        // Se for troca de slide (e n√£o o primeiro), toca a narra√ß√£o automaticamente
        if(currentPrologueIndex > 0) manageAudioState(prologueData[currentPrologueIndex].audio, true);
    }

    // --- INTERA√á√ïES: capa -> pr√≥logo ---
    function openPrologueFromCover(){
        // Fade out da capa e mostra pr√≥logo
        coverScreen.style.opacity = '0';
        setTimeout(()=> {
            coverScreen.style.display = 'none';
            mainBg.style.display = 'block';
            prologueContainer.style.display = 'flex';
            currentStage = 'prologue';
            updatePrologue();

            // Carrega audio do primeiro slide (mas n√£o toca)
            if(prologueData[0].audio){
                audioPrologue.src = prologueData[0].audio;
                audioPrologue.load();
                btnPlayPause.innerText = "‚ñ∂Ô∏è Tocar Narra√ß√£o";
            }
        }, 550);
    }

    coverScreen.addEventListener('click', openPrologueFromCover);
    coverScreen.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') openPrologueFromCover(); });

    // --- EVENTOS DOS BOT√ïES DO PR√ìLOGO ---
    btnNext.addEventListener('click', () => {
        if (currentPrologueIndex < prologueData.length - 1) {
            currentPrologueIndex++;
            updatePrologue();
        } else {
            // FIM DO PR√ìLOGO -> MOSTRA TELA DE ALERTA (INTRO)
            stopDisasterEffect();
            try { audioPrologue.pause(); } catch(e){}
            currentStage = 'intro';

            // Reinicia e tenta tocar a not√≠cia imediatamente (h√° intera√ß√£o do usu√°rio)
            audioNews.currentTime = 0;
            audioNews.play().then(()=> {
                // Se quiser fade-in, descomente a linha abaixo
                fadeInAudio(audioNews, 900);
                console.log("√Åudio da not√≠cia iniciado.");
            }).catch(e => {
                console.warn("Reprodu√ß√£o da not√≠cia bloqueada (por pol√≠tica do navegador):", e);
            });

            // Troca telas e mostra intro
            prologueContainer.style.display = 'none';
            mainBg.style.backgroundImage = "url('img1.jpg')";
            mainBg.className = "background-fixed bg-game";
            introScreen.style.display = 'flex';
            setTimeout(()=> { introScreen.style.opacity = '1'; introScreen.setAttribute('aria-hidden','false'); }, 50);
        }
    });

    btnPrev.addEventListener('click', () => {
        if(currentPrologueIndex > 0){
            currentPrologueIndex--;
            updatePrologue();
        }
    });

    btnPlayPause.addEventListener('click', () => {
        // Se n√£o h√° src definido, carrega do √≠ndice atual
        const data = prologueData[currentPrologueIndex];
        if(!audioPrologue.getAttribute('src') && data && data.audio){
            audioPrologue.src = data.audio;
            audioPrologue.load();
        }

        if (audioPrologue.paused) {
            audioPrologue.play().then(()=> {
                btnPlayPause.innerText = "‚è∏Ô∏è Pausar Narra√ß√£o";
            }).catch(e=>{
                console.warn("Erro ao tentar tocar narra√ß√£o:", e);
            });
        } else {
            audioPrologue.pause();
            btnPlayPause.innerText = "‚ñ∂Ô∏è Tocar Narra√ß√£o";
        }
    });

    // --- INICIAR SIMULA√á√ÉO (DO INTRO -> JOGO) ---
    btnStartSim.addEventListener('click', () => {
        try { audioNews.pause(); } catch(e){}
        currentStage = 'game';

        // Toca √°udio do jogo com fade e ativa efeitos
        audioGame.currentTime = 0;
        audioGame.play().then(()=> {
            fadeInAudio(audioGame, 900);
        }).catch(e => console.warn("Erro game audio:", e));

        startDisasterEffect('rain');

        introScreen.style.transition = "opacity .9s";
        introScreen.style.opacity = '0';
        setTimeout(()=> {
            introScreen.style.display = 'none';
            introScreen.setAttribute('aria-hidden','true');
            gameContainer.style.display = 'flex';
            setTimeout(()=> {
                gameContainer.style.opacity = '1';
                gameContainer.style.animation = 'fadeIn .6s ease-out';
                goTo('start');
            }, 120);
        }, 800);
    });

    // --- MOTOR DO JOGO (CENAS) ---
    const story = {
        "start": { text: "[06:05] CONEX√ÉO ESTABELECIDA...\n\nO deslizamento acabou de acontecer. Qual sua prioridade?", choices: [{ text: "A - Ir para Zona de Impacto", target: "erro_gestao" }, { text: "B - Focar na Gest√£o", target: "fase_2" }] },
        "erro_gestao": { text: "Voc√™ ficou incomunic√°vel e abdicou da gest√£o.", feedback: { type: "error", msg: "ERRO DE GEST√ÉO: Microgerenciamento." }, choices: [{ text: "Reiniciar", target: "start" }] },
        "fase_2": { text: "Decis√£o correta. Como aloca a equipe?", feedback: { type: "success", msg: "ACERTO: Gest√£o de recursos." }, choices: [{ text: "A - 100% Impacto", target: "erro_prevencao" }, { text: "B - 70% Impacto / 30% Abrigos", target: "fase_3" }] },
        "erro_prevencao": { text: "Surto nos abrigos.", feedback: { type: "error", msg: "FALHA NA PREVEN√á√ÉO." }, choices: [{ text: "Tentar Novamente", target: "fase_2" }, { text: "Reiniciar", target: "start" }] },
        "fase_3": { text: "Alerta de Lepto e Respirat√≥rio. Prioridade?", feedback: { type: "success", msg: "ACERTO: Preven√ß√£o." }, choices: [{ text: "A - Profilaxia", target: "erro_clinico" }, { text: "B - Causa Raiz (Intersetorial)", target: "fase_4" }] },
        "erro_clinico": { text: "Enxugando gelo.", feedback: { type: "error", msg: "ERRO DE VIS√ÉO." }, choices: [{ text: "Tentar Novamente", target: "fase_3" }] },
        "fase_4": { text: "R√°dio mudo. O que faz?", feedback: { type: "success", msg: "ACERTO: Intersetorialidade." }, choices: [{ text: "A - Insistir r√°dio", target: "erro_burocracia" }, { text: "B - Ir ao QG", target: "vitoria" }] },
        "erro_burocracia": { text: "Perdeu tempo.", feedback: { type: "error", msg: "FALHA." }, choices: [{ text: "Tentar Novamente", target: "fase_4" }] },
        "vitoria": { text: "MISS√ÉO CUMPRIDA.", feedback: { type: "success", msg: "SUCESSO." }, choices: [{ text: "Reiniciar", target: "start" }] }
    };

    const textElement = document.getElementById('story-text');
    const choicesContainer = document.getElementById('choices-container');
    const feedbackArea = document.getElementById('feedback-area');

    // Typewriter simples
    function typeWriter(text, i, fnCallback) {
        if (i < text.length) {
            textElement.innerHTML = text.substring(0, i+1) + '<span class="cursor"></span>';
            setTimeout(() => typeWriter(text, i + 1, fnCallback), 14);
        } else {
            if (fnCallback) fnCallback();
        }
    }

    function goTo(sceneId){
        const scene = story[sceneId];
        textElement.innerHTML = ""; choicesContainer.innerHTML = ""; choicesContainer.style.opacity = "0"; feedbackArea.style.display = "none";

        if(scene.feedback){
            feedbackArea.style.display = "block";
            feedbackArea.className = scene.feedback.type === 'success' ? 'feedback-success' : 'feedback-error';
            feedbackArea.innerText = (scene.feedback.type === 'success' ? 'üë®‚Äç‚öïÔ∏èüëç ' : 'üë®‚Äç‚öïÔ∏èüëé ') + scene.feedback.msg;
        }

        typeWriter(scene.text, 0, ()=> renderButtons(scene.choices));
    }

    function renderButtons(choices){
        choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.innerText = choice.text;
            btn.className = 'btn';
            btn.onclick = ()=> goTo(choice.target);
            choicesContainer.appendChild(btn);
        });
        setTimeout(()=> choicesContainer.style.opacity = "1", 100);
    }

    // Acessibilidade: permitir navega√ß√£o por teclado no container de escolhas
    choicesContainer.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' && document.activeElement && document.activeElement.classList.contains('btn')){
            document.activeElement.click();
        }
    });

    // Inicializa (caso queira abrir direto sem capa, descomente a linha abaixo)
    // openPrologueFromCover();
</script>
</body>
</html>
